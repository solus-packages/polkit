From ed89ee8b73ccb36991ce7363d85749ddd67c3f0a Mon Sep 17 00:00:00 2001
From: Ikey Doherty <ikey@solus-project.com>
Date: Thu, 19 Oct 2017 17:28:04 +0100
Subject: [PATCH 2/3] Allow building with Duktape 2.x API

Signed-off-by: Ikey Doherty <ikey@solus-project.com>
---
 src/polkitbackend/Makefile.am                | 2 +-
 src/polkitbackend/polkitbackendjsauthority.c | 3 ++-
 2 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/src/polkitbackend/Makefile.am b/src/polkitbackend/Makefile.am
index ef6a9dd..d6e2ce0 100644
--- a/src/polkitbackend/Makefile.am
+++ b/src/polkitbackend/Makefile.am
@@ -36,7 +36,7 @@ libpolkit_backend_1_la_SOURCES =                                   			\
 	polkitbackendactionpool.h		polkitbackendactionpool.c		\
 	polkitbackendconfigsource.h		polkitbackendconfigsource.c		\
 	polkitbackendactionlookup.h		polkitbackendactionlookup.c		\
-	duktape.c duktape.h \
+	duktape.c duktape.h duk_v1_compat.c \
         $(NULL)
 
 if HAVE_LIBSYSTEMD
diff --git a/src/polkitbackend/polkitbackendjsauthority.c b/src/polkitbackend/polkitbackendjsauthority.c
index 062b6c5..7f89bc4 100644
--- a/src/polkitbackend/polkitbackendjsauthority.c
+++ b/src/polkitbackend/polkitbackendjsauthority.c
@@ -41,6 +41,7 @@
 
 #include "initjs.h" /* init.js */
 #include "duktape.h"
+#include "duk_v1_compat.h"
 
 /**
  * SECTION:polkitbackendjsauthority
@@ -893,7 +894,7 @@ spawn_cb (GObject       *source_object,
 static duk_ret_t
 js_polkit_spawn (duk_context *cx)
 {
-  duk_ret_t ret = DUK_RET_INTERNAL_ERROR;
+  duk_ret_t ret = DUK_ERR_ERROR;
   gchar *standard_output = NULL;
   gchar *standard_error = NULL;
   gint exit_status;
-- 
2.14.2

